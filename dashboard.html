<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聖誕市集導覽</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            position: fixed;
            top: 0;
            width: 100%;
            background-color: #333;
            color: white;
            text-align: center;
            z-index: 1000;
        }

        header a {
            flex: 1;
            text-align: center;
            text-decoration: none;
            color: white;
            display: inline-block;
        }

        header img {
            width: 30px;
            height: 30px;
            margin-bottom: 5px;
        }

        header div {
            display: flex;
            justify-content: space-evenly;
            background-color: #333;
            padding: 10px 0;
        }

        header a:hover {
            background-color: #575757;
        }

        section {
            padding: 20px;
            padding-top: 80px;
            /* Account for fixed header */
            scroll-margin-top: 80px;
            /* Prevent content overlap when scrolling */
            margin: 10px;
            border-bottom: 1px solid #ccc;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: #333;
            color: white;
        }
        .lyrics {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        .song-button {
            padding-top: 80px;
            /* Account for fixed header */
            scroll-margin-top: 80px;
            /* Prevent content overlap when scrolling */
            font-size: 1.2em; /* 將字體放大，調整數值來控制大小 */
            padding: 10px 15px; /* 調整按鈕的內邊距以適應放大的字體 */
            background-color: #f0f0f0; /* 可選：按鈕背景色 */
            border: 1px solid #ccc; /* 可選：按鈕邊框 */
            border-radius: 5px; /* 可選：按鈕圓角 */
            cursor: pointer; /* 滑鼠移到按鈕時顯示指標 */
        }

        .song-button:hover {
            background-color: #e0e0e0; /* 可選：滑鼠懸停時的背景顏色 */
        }

        ul {
            padding: 0;
            list-style-type: none;
        }
        ul > li {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <header>
        <!-- Navigation Buttons with Icons -->
        <div>
            <a href="#schedule">
                <img src="img/time.gif" alt="時間表"><br>
                時間表
            </a>
            <a href="#map">
                <img src="img/store.gif" alt="地圖"><br>
                地圖
            </a>
            <a href="#songs">
                <img src="img/song.gif" alt="曲目"><br>
                曲目
            </a>
            <a href="#transactions">
                <img src="img/transaction.gif" alt="交易明細"><br>
                明細
            </a>
        </div>
    </header>

    <!-- Time Schedule Section -->
    <section>
        <h2>數位餐券</h2>
        <!-- <div style="margin: 20px;background-color: #f9f9f9;"> -->
        <div style="text-align: center;">
            <!-- 開啟 LINE 掃描器按鈕 -->
            <button onclick="window.location.href='line://nv/addFriends'"
                style="background-color: #00c300; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px; margin-top: 10px; cursor: pointer;">
                開啟 LINE 掃描器
            </button>

            <!-- 使用說明 -->
            <ol style="margin-top: 15px; font-size: 16px; line-height: 1.6; text-align: left;">
                <li>點擊上方的「開啟 LINE 掃描器」按鈕，會跳轉到 LINE 的加入好友畫面。</li>
                <li>在跳轉的畫面中，點選紅框中的「行動條碼」按鈕即可開啟掃描器。</li>
                <li>使用掃描器掃描攤位 QR Code，即可進行消費或交易。</li>
            </ol>

            <!-- 圖示 -->
            <img src="img/scan.jpg" alt="掃描器圖示"
                style="width: 100%; height: auto; margin-top: 15px; border: 1px solid #ccc; border-radius: 10px;">
        </div>
        <!-- </div> -->

    </section>
    <section id="schedule">
        <h2>時間表</h2>
        <ul>
            <li>16:00 - 樂團表演-演唱:如美</li>
            <li>17:00 - 樂團表演-演唱:馨沂</li>
            <li>18:30 - 樂團表演-演唱:雯娟</li>
            <li>19:30 - 樂團表演-演唱:阿馨</li>
            <li>20:30 - 平安夜大合唱</li>
        </ul>
        <p>樂團表演包含聖誕老公公登場</p>
    </section>

    <!-- Map Section -->
    <section id="map">
        <h2>地圖</h2>
        <p>以下是聖誕市集的攤位分布圖：</p>
        <img src="img/map1.jpg" alt="市集平面圖" style="width: 100%; height: auto;">
    </section>

    <!-- Song List Section -->
    <section id="songs">
        <h2>歌曲曲目</h2>
        <h3>如美</h3>
        <ul>
            <li><a href="#lyrics1-1" id="lyrics1-1" class="song-button">我主我真快樂</a>
                <div class="lyrics">
                    我真快樂因認識救主，生命之中充滿主恩典  <br>
                    生活行為得到大改變，我主我真快樂  <br>
                    <br>
                    我真快樂因得新生命，耶穌與我關係真親密<br>
                    在祂奇妙救恩中有份，我主我真快樂<br>
                    <br>
                    我真快樂 人生路雖有眼淚<br>
                    我已得秘訣主耶穌在我心<br>
                    我真快樂罪已得赦免，生命生活充滿了意義 <br>
                    歡喜快樂奔向天堂路，我主我真快樂<br>
                    我主我真快樂<br>
                    </div>
            </li>
            <li><a href="#lyrics1-2" id="lyrics1-2" class="song-button">無人像耶穌這樣愛顧我</a>
                <div class="lyrics">
                    讓我向你述說主耶穌的寶貴<br>
                    祂是我忠心朋友永不改變<br>
                    讓我向你述說祂如何改造我<br>
                    無人像祂救我脫離眾罪鏈<br>
                    <br>
                    當我陷在罪中時，主來尋找我<br>
                    那時我心中充滿失望痛苦<br>
                    耶穌用慈愛大能膀臂扶助我<br>
                    引導我走那永生公義道路<br>
                    <br>
                    無人像耶穌這樣愛顧我<br>
                    無朋友像主這樣仁愛<br>
                    無人像祂能把我罪惡全赦免<br>
                    主愛我何等大哉<br>
                    </div>
            </li>
            <li><a href="#lyrics1-3" id="lyrics1-3" class="song-button">倚靠上帝永恆的膀臂</a>
                <div class="lyrics">
                    何等大喜樂 何等的情誼<br>
                    倚靠上帝永恆的膀臂<br>
                    何等真平安 何等大福氣<br>
                    倚靠上帝永恆的膀臂<br>
                    <br>
                    何等的甜美 人生旅途中<br>
                    倚靠上帝永恆的膀臂<br>
                    信心越成長 日日越光明<br>
                    倚靠上帝永恆的膀臂<br>
                    <br>
                    我不再害怕 我不再憂愁<br>
                    倚靠上帝永恆的膀臂<br>
                    心中有平安 與我主親近<br>
                    倚靠上帝永恆的膀臂<br>
                    <br>
                    倚靠 倚靠<br>
                    平安在主永恆的膀臂<br>
                    倚靠 倚靠<br>
                    倚靠上帝永恆的膀臂<br>
            </li>
            <li><a href="#lyrics1-4" id="lyrics1-4" class="song-button">神愛你</a>
                <div class="lyrics">
                    世上最甜蜜的故事，神愛你<br>
                    最光彩美麗的圖畫，神愛你<br>
                    當你前途如黑夜，主保守你不傾跌<br>
                    祂必緊握你的手，神愛你<br>
                    <br>
                    當勇敢消失壓力重，神愛你<br>
                    你當記住在試煉中，神愛你<br>
                    希望好像已破滅，你覺得非常孤單<br>
                    向上仰望見曙光，神愛你<br>
                    </div>
            </li>
            <li><a href="#lyrics1-5" id="lyrics1-5" class="song-button">星星上的禮物</a>
                <div class="lyrics">
                    在星空下飛往那滿載著夢想的天空<br>
                    我多麼想和你一起遨遊在夜空之下<br>
                    啊~啊~啊~<br>
                    你的微笑像沙漠裡的一朵花<br>
                    那麼溫柔那麼慈祥那麼甜蜜難忘懷<br>
                    啊~啊~啊~<br>
                    在嚴冬寂寞的夜晚你陪著我<br>
                    我要謝謝你<br>
                    謝謝你陪我度過每一天<br>
                    </div>
            </li>
        </ul>


        <h3>馨沂</h3>
        <ul>
            <li><a href="#lyrics2-1" id="lyrics2-1" class="song-button">聖誕結</a>
                <div class="lyrics">
                    在很久很久以前 有個故事有點特別<br>
                    它說有個嬰孩來到世界<br>
                    從此以後有個聖誕節<br>
                    <br>
                    全世界為了這一天 送著禮物寫著卡片<br>
                    這是許多人心裡一個結<br>
                    不瞭解人們為何喜悅<br>
                    <br>
                    聖誕結 解開了會看見<br>
                    不是熱鬧燈街 是耶穌降生的夜<br>
                    這一天 世界更多笑臉<br>
                    因為你我就算不完美 耶穌祂能代替一切<br>
            </li>
            <li><a href="#lyrics2-2" id="lyrics2-2" class="song-button">如祢</a>
                <div class="lyrics">
                    站立在祢座前<br>
                    站立在 祢信實面前<br>
                    祢雙手領我 走出曠野<br>
                    看見祢為我所預備<br>
                    <br>
                    我要貼近 貼近祢心跳的聲音<br>
                    思緒如祢 步伐如祢 更靠近祢<br>
                    活出 像祢 豐盛的生命<br>
                    我要領受 祢起初對我的心意<br>
                    我心渴望 榮耀如祢 聖潔如祢 <br>
                    基督 耶穌 我全屬於祢   <br>
                    <br>
                    光照在黑暗裡    使臉上帕子都挪去<br>
                    祢話語如鏡  煉淨我心<br>
                    榮上加榮 因祢聖靈<br>
                    <br>
                    我心 坦然無懼 敬拜祢 跟隨祢<br>
                    永恆 在祢手裡  我放下 自己<br>
            </li>
            <li><a href="#lyrics2-3" id="lyrics2-3" class="song-button">若有人在基督裡</a>
                <div class="lyrics">
                    我來到主座前<br>
                    生命交由祢掌權<br>
                    祢心意向我彰顯<br>
                    我願成為祢榮耀的殿<br>
                    <br>
                    舊事已過 全是新的<br>
                    因主的愛 得已重生<br>
                    現在活著 不再是我 <br>
                    乃是基督在我裡面活著<br>
                    <br>
                    若有人在基督裡     <br>
                    若有人在基督裡  <br>
                    他是全新的人<br>
                    他是全新的人<br>
                    我生命全屬於祢<br>
                    我生命全屬於祢<br>
                    因祢為我捨己<br>
                    因祢為我捨己<br>
                    <br>
                    舊事已過<br>
                    全是新的 全是新的<br>
            </li>
            <li><a href="#lyrics2-4" id="lyrics2-4" class="song-button">恩典之洋</a>
                <div class="lyrics">
                    你在水面上呼喚著我<br>
                    跨入未知　深怕失落<br>
                    在奧秘中當我尋見你<br>
                    在深海裡　我仍站立<br>
                    <br>
                    我全心呼求你聖名<br>
                    我的眼單單仰望你<br>
                    大海翻騰　我卻安息　在你懷裡<br>
                    因你屬我　而我屬你<br>
                    <br>
                    水深之處　你恩典湧流<br>
                    你手掌權　牽引著我<br>
                    就在我深陷恐懼軟弱<br>
                    你永不失手　扶持著我<br>
                    <br>
                    聖靈引領　使我信心沒有界線<br>
                    讓我能行走在水面<br>
                    呼召我快跑跟隨<br>
                    你牽引我　讓我更深與你同行<br>
                    使我信心更加堅定<br>
                    在我救主同在裡<br>
            </li>
            
        </ul>
        
        <h3>雯娟</h3>
        <ul>
            <li><a href="#lyrics3-1" id="lyrics3-1" class="song-button">一直都是你</a>
                <div class="lyrics">
                    祢看見我<br>
                    在我人生低谷，祢擁抱著我<br>
                    那一刻，祢輕聲呼喚我的名<br>  
                    是我第一次不再感到害怕<br>  
                    我不害怕<br>  
                    <br>
                    我北極星<br>  
                    願祢愛成為我心的指南針<br>  
                    哦，我只想要和祢在一起<br>  
                    和祢在一起<br> 
                    <br>
                    祢聲音平息我心中的暴風雨<br>  
                    像堅固城牆般圍繞我<br>  
                    一直以來守護我的是祢<br>  
                    <br>
                    祢的光照亮每一條黑暗隧道<br>  
                    過去祢在，未來祢也在<br>  
                    祢的愛沒放棄追隨我<br>  
                    原來都是祢，一直都是祢<br>   
                    <br>
                    誰曾與我在火中站立？<br>  
                    那是祢，一直都是祢<br>  
                    誰曾把我從水中救出？<br>  
                    那是祢，一直都是祢<br>  
                    誰曾把我扛在祂肩上？<br>  
                    那是祢，一直都是祢<br>  
                    我知道是祢<br>  </div>
            </li>
            <li><a href="#lyrics3-2" id="lyrics3-2" class="song-button">加利利的海</a>
                <div class="lyrics">是祢翻轉我生命<br>
                    以馬內利打開我心<br>
                    呼召我得人如魚<br>
                    這是新的命定<br>
                    <br>
                    我願緊緊抓住祢<br>
                    行在水面 向祢靠近<br>
                    放下過去不再恐懼<br>
                    耶穌的愛已向我顯明<br>
                    <br>
                    加利利的海<br>
                    是祢找到我的船<br>
                    軟弱時我回來<br>
                    以為祢不會在<br>
                    誰知道 撒了網<br>
                    眼淚又流了下來<br>
                    我根本不配得這份愛<br>
                    <br>
                    加利利的海<br>
                    滿了魚的船<br>
                    是祢的呼喚<br>
                    趕走我的不安<br>
                    我說主若是祢<br>
                    就讓我渡到那裡<br>
                    一路上是祢叫風浪止息 <br>
                    耶穌<br>
                    <br>
                    這一次 我不再失敗<br>
                    再一次 捨下我的船<br>
                    天亮以前以後<br>
                    我都要承認<br>
                    祢是我主我王<br>
                    過去現在未來<br>
                    不變的回答<br>
                    我要牧養祢的羊<br>
                    不論剛強軟弱<br>
                    加利利的海<br>
                    耶穌為我而來<br></div>
            </li>

            <li><a href="#lyrics3-3" id="lyrics3-3" class="song-button">都指向你</a>
                <div class="lyrics">跳脫 這世界的節奏 <br>
                    一切烏雲拋在腦後 <br>
                    全心 開口向祢呼求 <br>
                    愛像狂浪襲捲我<br>
                    <br>
                    如今 我已不再是我 <br>
                    神兒子在我裡面活<br>
                    我要 用力張開雙手 <br>
                    伸向有祢的天空<br>
                    <br>
                    太陽 星宿 <br>
                    祢創造整個宇宙 <br>
                    祢卻回頭顧念我<br>
                    說有 就有 <br>
                    祢話語絕不落空 <br>
                    還有更多<br>
                    <br>
                    耶穌 所有預言都指向祢<br>
                    恩典 拯救每個人的生命<br>
                    我深知前方道路總有祢帶領<br>
                    耶穌 所有見證都指向祢<br>
                    宣告 得勝盼望永不止息<br>
                    我決定一生跟隨祢 <br>
                    到底<br></div>
            </li>
            <li><a href="#lyrics3-4" id="lyrics3-4" class="song-button">以馬內利</a>
                <div class="lyrics">在火窯中 捆鎖裡 無聲的吶喊裡<br>
                    沙漠中 墳墓裡 孤單的等待裡<br>
                    我在尋找你<br>
                    不停尋找你<br>
                    <br>
                    在火窯中 捆鎖裡 無聲的吶喊裡<br>
                    沙漠中 墳墓裡 孤單的等待裡<br>
                    我在尋找你<br>
                    清楚的身影<br>
                    <br>
                    以馬內利 以馬內利<br>
                    聖殿幔子已裂開<br>
                    榮光遮蓋全地<br>
                    <br>
                    以馬內利 以馬內利<br>
                    萬民齊來敬拜你<br>
                    你與我們同在<br>
                    <br>
                    有一嬰孩為我們而生<br>
                    有一子賜給我們<br>
                    祂是奇妙策士 全能的神<br>
                    <br>
                    有一嬰孩為我們而生<br>
                    有一子賜給我們<br>
                    祂是永在的父 和平的君<br></div>
            </li>
        </ul>
        <h3>阿馨</h3>
        <ul>

            <li><a href="#lyrics4-1" id="lyrics4-1" class="song-button">我要歌唱</a>
                <div class="lyrics">我要大聲歌唱，賜給我自由主的慈愛<br>
                    擺上祂的所有的一切<br>主耶穌拯救了我<br>
                    <br>
                    我要大聲歌唱，拯救我的主祂的恩典<br>
                    擺上我的所有的一切<br>將我生命獻給主<br>
                    <br>
                    誰能使我們與我們的主基督的愛分開<br>
                    <br>
                    我為主而活，只要為我主而活<br>
                    世界任何事不能阻擋我<br>
                    主耶穌的愛，擁抱著微小的我<br>
                    喔我要活在主的榮耀中<br>
                    <br>
                    我要大聲歌唱，賜給我自由主的慈愛<br>
                    擺上祂的所有的一切<br>主耶穌拯救了我<br>
                    <br>
                    我要大聲歌唱，拯救我的主祂的恩典<br>
                    擺上我的所有的一切<br>將我生命獻給主<br>
                    <br>
                    誰能使我們與我們的主基督的愛分開<br>
                    <br>
                    我為主而活，只要為我主而活<br>
                    世界任何事不能阻擋我<br>
                    主耶穌的愛，擁抱著微小的我<br>
                    喔我要活在主的榮耀中<br>
                    <br>
                    我為主而活，只要為我主而活<br>
                    世界任何事不能阻擋我<br>
                    主耶穌的愛，擁抱著微小的我<br>
                    喔我要活在主的榮耀中<br>
                    <br>
                    我為主而活，只要為我主而活<br>
                    世界任何事不能阻擋我<br>
                    主耶穌的愛，擁抱著微小的我<br>
                    喔我要活在主的榮耀中<br></div>
            </li>

            <li><a href="#lyrics4-2" id="lyrics4-2" class="song-button">求充滿這地</a>
                <div class="lyrics">喔主 感謝祢創造這土地<br>
                    以永恆話語賜下無限生命<br>
                    用恩典的馨香氣息祝福這地<br>
                    讓我們全心跟隨祢帶領<br>
                    <br>
                    喔主 感謝祢創造這土地<br>
                    以慈愛澆灌，以喜樂耕耘<br>
                    用無數的白晝黑夜孕育這地<br>
                    順服的人情感恩的心情<br>
                    現在都只願以基督的心為心<br>
                    <br>
                    主求祢充滿我們 來醫治這地<br>
                    痛苦疾病要過去 神蹟在運行<br>
                    主求祢充滿我們 來轉化這地<br>
                    黑暗權勢要離去<br>
                    <br>
                    主求祢充滿我們 來醫治這地<br>
                    全地看見祢榮耀 祢復興降臨<br>
                    主求祢充滿我們 來轉化這地<br>
                    全地尊榮祢聖名 為祢而站立<br>
                    <br>
                    一生祝福 永不停息<br>
                    世代因祢愛延續 呼求祢<br>
                    <br>
                    一生祝福 永不停息<br>
                    世代因祢愛延續 呼求祢<br>
                    <br>
                    主求祢充滿我們 來醫治這地<br>
                    痛苦疾病要過去 神蹟在運行<br>
                    主求祢充滿我們 來轉化這地<br>
                    黑暗權勢要離去<br>
                    <br>
                    主求祢充滿我們 來醫治這地<br>
                    全地看見祢榮耀 祢復興降臨<br>
                    主求祢充滿我們 來轉化這地<br>
                    全地尊榮祢聖名 為祢而站立<br></div>
            </li>

            <li><a href="#lyrics4-3" id="lyrics4-3" class="song-button">主我獻上生命給你 + 在呼召我之處</a>
                <div class="lyrics">我將自己完全獻上<br>
                    毫無保留放在祢的腳前<br>
                    所有的悔恨一切的稱讚<br>
                    無論苦與樂都交託給祢<br>
                    <br>
                    過去的事 將來的事<br>
                    還有那沒有實現的夢想<br>
                    我所有希望<br>
                    我所有計劃<br>
                    全人和全心<br>
                    都交託給祢<br>
                    <br>
                    主 我獻上生命給祢<br>
                    用我一切經歷<br>
                    來榮耀祢聖名<br>
                    主 我獻上一生給祢<br>
                    願我讚美升起<br>
                    能成為馨香活祭<br>
                    我獻上生命給祢<br>
                    <br>
                    在呼召的所在，我欲歡喜吟詩<br>
                    無論環境好壞，猶原贊美敬拜<br>
                    <br>
                    在呼召的所在，我欲歡喜吟詩<br>
                    無論環境好壞，猶原贊美敬拜<br>
                    <br>
                    主溫柔的聖神，惦在我的內心<br>
                    陪伴我的一生，賞賜平靜和安息<br>
                    使我得滿足豐盛<br>
                    <br>
                    主愛疼的真理，光照我攏無離<br>
                    我身軀你扶持，賞賜恩典和安慰<br>
                    祢的愛真正甘甜<br>
                    <br>
                    在呼召的所在，我欲歡喜吟詩<br>
                    無論環境好壞，猶原贊美敬拜<br>
                    <br>
                    在呼召的所在，我欲歡喜吟詩<br>
                    無論環境好壞，猶原贊美敬拜<br></div>
            </li>

            <li><a href="#lyrics4-4" id="lyrics4-4" class="song-button">祢是我天父</a>
                <div class="lyrics">不論我逃到哪裡去祢都看顧<br>
                    不論我犯了什麼錯祢你接納我<br>
                    祢擦去我眼淚跌倒祢扶持我<br>
                    我的生命因著祢恩典完全<br>
                    <br>
                    不論我要往哪裡去祢都同行<br>
                    不論我無助或軟弱祢不離棄<br>
                    祢擦去我眼淚跌倒祢扶持我<br>
                    我的生命因著祢恩典完全<br>
                    <br>
                    祢是我天父 供應我，祢是我的拯救 <br>
                    祢慈愛擁抱我 環繞我，永遠不離開我<br>
                    天父我敬拜祢 天父我敬拜祢<br>
                    <br>
                    不論我要往哪裡去祢都同行<br>
                    不論我無助或軟弱祢不離棄<br>
                    祢擦去我眼淚跌倒祢扶持我<br>
                    我的生命因著祢恩典完全<br>
                    <br>
                    祢是我天父 供應我，祢是我的拯救 <br>
                    祢慈愛擁抱我 環繞我，永遠不離開我<br>
                    天父我敬拜祢 天父我敬拜祢<br>
                    <br>
                    祢愛為我存在<br>
                    祢愛為我存在<br>
                    祢的愛直到永遠<br>
                    <br>
                    祢愛為我存在<br>
                    祢愛為我存在<br>
                    祢的愛直到永遠<br>
                    <br>
                    祢是我天父 供應我，祢是我的拯救 <br>
                    祢慈愛擁抱我 環繞我，永遠不離開我<br>
                    天父我敬拜祢 天父我敬拜祢<br>
                    <br>
                    祢是我天父 供應我，祢是我的拯救 <br>
                    祢慈愛擁抱我 環繞我，永遠不離開我<br>
                    天父我敬拜祢 天父我敬拜祢<br></div>
            </li>
            
        </ul>
        
    </section>

    <!-- Transaction Details Section -->
    <section id="transactions">
        <h2>交易紀錄</h2>
        <div id="remaining">
            <!-- Data cards will be inserted here by JS -->
        </div>
        <div id="dataContainer">
            <!-- 卡片內容將通過 JavaScript 直接渲染 -->
        </div>
    </section>

    <footer>
        &copy; 2024 鼎金長老教會聖誕市集 All Rights Reserved.
    </footer>

    <script>

        // 從 URL 中讀取參數
        const urlParams = new URLSearchParams(window.location.search);
        const memberName = urlParams.get('member');
        const userId = urlParams.get('userid');
        if (userId) {
            getRecords(userId, null);
        } else {
            let IDKey;
            // 取得key以讀取local storage
            fetch('env.php')
            .then(response => response.json())
            .then(data => {
                IDKey = data.idKey;
                console.log(`IDKey: ${IDKey}`);
            })
            .catch(error => {
                console.error('Error fetching environment variables:', error);
            });

            const encryptedId = localStorage.getItem(IDKey);
            console.log(encryptedId);

            if (encryptedId) {
                getRecords(null, encryptedId);
            }
        }

        const ws = new WebSocket('wss://www.wjtolive.com:8080');  // 連接 PHP WebSocket 伺服器

        ws.onmessage = function (event) {
            const data = JSON.parse(event.data);
            console.log('Received message from WebSocket:', data);
            if (data.event === 'consume' || data.event === 'records') {
                // 假設這裡根據店家名稱刷新紀錄
                if (userId === data.member) {
                    getRecords(userId, null);  // 假設這是用來刷新交易紀錄的函數
                }
            }
        };

        ws.onopen = function () {
            console.log('Connected to WebSocket server');
        };

        function getRecords(user_id, encryptedId) {
            console.log(`getRecords: ${user_id}`);
            // Fetch data with selected store and check flag
            fetch('records.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    member: user_id,
                    encryptedId: encryptedId
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        window.location.replace(`quiz.html?member=${memberName}&userid=${userId}`);
                    } else if (data.some(item => item.store_name === '服務台' && item.check_flag === 0)) {
                        window.location.replace(`claim.html?member=${memberName}&userid=${userId}`);
                    }
                    console.log(`data: ${JSON.stringify(data, undefined, 2)}`);
                    // Clear previous data
                    const container = document.getElementById("dataContainer");
                    container.innerHTML = '';
                    let sum = 0;
                    data.forEach(item => {
                        if (item.store_name === '服務台' && item.check_flag === 1) {
                            sum += item.amount;
                            return;
                        }
                        // "SELECT tr.id, m.name, s.name, tr.amount, tr.trade_time, tr.check_flag
                        const card = document.createElement("div");
                        card.classList.add("card");

                        const cardContent = document.createElement("div");
                        cardContent.classList.add("card-content");

                        // Card content
                        console.log(`id: ${item.id}, 
                        member_name: ${item.member_name}
                        store_name: ${item.store_name}
                        amount: ${item.amount}
                        trade_time: ${item.trade_time}
                        check_flag: ${item.check_flag}`);
                        const no = document.createElement("h3");
                        no.textContent = item.id.toString().padStart(5, '0');
                        // str.padStart(6, '0');
                        cardContent.appendChild(no);

                        const name = document.createElement("h3");
                        name.textContent = item.member_name;
                        cardContent.appendChild(name);

                        const store = document.createElement("p");
                        store.textContent = `店家: ${item.store_name}`;
                        cardContent.appendChild(store);

                        const amount = document.createElement("p");
                        amount.textContent = `金額: ${item.amount}`;
                        if (item.check_flag === 0) {
                            amount.textContent = `金額: ${item.amount}(取消付款)`;
                            amount.style.color = 'red';
                        }
                        cardContent.appendChild(amount);
                        if (item.check_flag === 1) {
                            sum += item.amount;
                        }

                        const date = document.createElement("p");
                        date.textContent = `時間: ${item.trade_time}`;
                        cardContent.appendChild(date);

                        card.appendChild(cardContent);

                        // Append the card to the container
                        container.appendChild(card);
                    });
                    document.getElementById("remaining").textContent = `剩餘 ${sum} 元`;
                })
                .catch(error => console.error('Error fetching data:', error));
        }
        document.querySelectorAll('.song-button').forEach(button => {
            button.addEventListener('click', () => {
                // 隱藏其他展開的歌詞
                document.querySelectorAll('.lyrics').forEach(lyrics => {
                    if (lyrics !== button.nextElementSibling) {
                        lyrics.style.display = 'none';
                    }
                });

                // 切換當前歌詞的顯示狀態
                const lyrics = button.nextElementSibling;
                lyrics.style.display = lyrics.style.display === 'block' ? 'none' : 'block';
            });
        });
    </script>

</body>

</html>